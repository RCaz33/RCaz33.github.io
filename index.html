<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>RCaz33 | GitHub Portfolio</title>

  <!-- Tailwind (via CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    /* ---- Core layout helpers ---- */
    .gradient-bg {background:linear-gradient(135deg,#4078c0,#6e5494);}
    .text-gradient
      {background:linear-gradient(to right,#fafafa,#f5f5f5);
       -webkit-background-clip:text;-webkit-text-fill-color:transparent;}
    .shadow-hover:hover{box-shadow:0 12px 25px rgba(0,0,0,.1);
                         transform:translateY(-3px);}
    .transition{transition:background .3s ease,transform .3s ease;}
    .rounded-xl{border-radius:1rem;}
    .pulse{animation:pulse 2s infinite;}
    @keyframes pulse{0%{opacity:1}50%{opacity:.6}100%{opacity:1}}

    /* ---- Chat widget ---- */
    .chat-widget{
      position:fixed;bottom:24px;right:24px;
      width:56px;height:56px;border-radius:9999px;
      background:linear-gradient(135deg,#4078c0,#6e5494);
      border:none;color:#fff;font-size:22px;
      cursor:pointer;box-shadow:0 10px 20px rgba(0,0,0,.25);
      display:flex;align-items:center;justify-content:center;z-index:1000;
    }
    .chat-widget:hover{opacity:.96;}
    .chat-container{
      position:fixed;bottom:96px;right:24px;
      width:380px;height:520px;background:#fff;
      border-radius:16px;box-shadow:0 25px 50px rgba(0,0,0,.2);
      display:flex;flex-direction:column;overflow:hidden;
    }
    .chat-container.hidden{display:none;}
    #chat-header{
      padding:14px 18px;background:linear-gradient(135deg,#4078c0,#6e5494);
      color:#fff;display:flex;justify-content:space-between;align-items:center;
    }
    #chat-header h3{font-weight:600;font-size:.95rem;}
    #chat-header button{background:transparent;border:none;color:#fff;font-size:20px;}
    #chat-messages{flex-grow:1;overflow-y:auto;padding:16px;background:#f8fafc;}
    #chat-input-area{display:flex;gap:10px;padding:12px;border-top:1px solid #e5e7eb;}
    #chat-input{
      flex-grow:1;padding:10px 12px;border:1px solid #d1d5db;
      border-radius:9px;font-size:.95rem;background:#fff;
    }
    #send-message{
      background:#4078c0;color:#fff;border-radius:9px;padding:0 16px;
      font-size:.95rem;cursor:pointer;
    }
    .user-message{background:#ebf2ff;margin-left:auto;
                  border-bottom-right-radius:.5rem;}
    .bot-message{background:#f0f9ff;margin-right:auto;
                  border-bottom-left-radius:.5rem;
                  box-shadow:0 1px 4px rgba(0,0,0,.05);}
  </style>
</head>
<body class="font-sans antialiased text-gray-900 bg-gray-50">

  <!-- Navigation (fixed markup) -->
  <nav class="bg-white shadow-lg p-4">
    <!-- put your real nav links here -->
    <ul class="flex space-x-4">
      <li><a href="#" class="text-gray-800 hover:text-blue-600">Home</a></li>
      <li><a href="#" class="text-gray-800 hover:text-blue-600">Projects</a></li>
      <li><a href="#" class="text-gray-800 hover:text-blue-600">About</a></li>
      <li><a href="#" class="text-gray-800 hover:text-blue-600">Contact</a></li>
    </ul>
  </nav>

  <!-- ------------------- New Chat UI ------------------- -->
  <button id="chat-toggle"
          class="chat-widget"><i class="fas fa-comments"></i></button>

  <div id="chat-container" class="chat-container hidden">
    <div id="chat-header">
      <h3>Message Bot</h3>
      <button id="close-chat">&times;</button>
    </div>
    <div id="chat-messages"></div>

    <div id="chat-input-area">
      <input type="text" id="chat-input"
             placeholder="Type a message…" autocomplete="off" />
      <button id="send-message">Send</button>
    </div>
  </div>

  <!-- Content that was already on your page (keep it exactly as you wrote) -->
  <!-- ... your hero, stats, about, repos … -->

  <!-- Gradio client (load *after* the DOM) -->
  <script src="https://cdn.jsdelivr.net/npm/@gradio/client/dist/index.umd.min.js"
          integrity="sha384-5Zl6Kf5p6cM2R4e7Yc5K7cRJf+jcZc6vV8hKf+eYlYy8J1j6c4U+v6gYfGx2"
          crossorigin="anonymous"></script>

  <!-- Marked.js (client‑side markdown parser) -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <script type="module">

    
    async function initChatWidget() {
      const client = await new window.Gradio.Client(
        "https://rcaz-avatar-bot.hf.space"
      );

      const chatToggle        = document.getElementById('chat-toggle');
      const chatContainer     = document.getElementById('chat-container');
      const closeChat         = document.getElementById('close-chat');
      const chatInput         = document.getElementById('chat-input');
      const sendButton        = document.getElementById('send-message');
      const messagesContainer = document.getElementById('chat-messages');

      // Start with an empty history – the backend expects at least one pair
      let chatHistory = [["You can ask anything about Remi's education and work experiences", ""]];

      chatToggle.addEventListener('click', () => chatContainer.classList.remove('hidden'));
      closeChat.addEventListener('click', () => chatContainer.classList.add('hidden'));


      function appendMessage(text, sender) {
        const div = document.createElement('div');
        div.className = `message ${sender}-message`;
        // Keep plain text if the backend returns a safety‑filtered string,
        // otherwise render markdown (only when sender === "bot")
        div.textContent = text;
        if (sender === 'bot') div.innerHTML = marked.parse(text);
        messagesContainer.appendChild(div);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }


      async function sendMessage() {
        const userMessage = chatInput.value.trim();
        if (!userMessage) return;

        appendMessage(userMessage, 'user');
        chatInput.value = '';

        try {
          // The Gradio endpoint expects an **array** as its first argument.
          // Here we send the raw string; the second element is the current
          // history, which we keep as a single‑pair list.
          const result = await client.predict("/chat", [userMessage, chatHistory]);

          // The library returns an array of objects; we only care about the
          // first one's `.data` property.
          const botMessage = typeof result.data[0] === 'string'
            ? result.data[0]
            : "";

          appendMessage(botMessage, 'bot');
          // Keep only the most recent pair for the *next* turn.
          chatHistory = [[userMessage, botMessage]];
        } catch (err) {
          console.error('❌ Gradio error:', err);
          const msg = (err?.data?.error) || "Sorry, there was an error processing your request.";
          appendMessage(msg, 'bot');
        }
      }

      // Trigger on button click or ENTER key
      sendButton.addEventListener('click', sendMessage);
      chatInput.addEventListener('keypress', e => {
        if (e.key === 'Enter') sendMessage();
      });
    }


    window.addEventListener('DOMContentLoaded', initChatWidget);
  </script>
</body>
</html>
